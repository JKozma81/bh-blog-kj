<div class="container-fluid p-5 d-flex flex-column align-items-center new-post-site">
  <h1 class="pb-3">{{submenuTitle}}</h1>
  <form method="POST" action="/posts" class="new-post-form needs-validation">
    <div class="form-group row">
      <label for="post_title" class="col-sm-2 col-form-label">Title</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="post_title" name="title" {{#if title}}value="{{title}}" {{/if}}
          placeholder="Some blogpost title" required>
      </div>
    </div>
    <div class="form-group row">
      <label for="post_slug" class="col-sm-2 col-form-label">Slug</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="post_slug" name="slug" {{#if slug}}value="{{slug}}" {{/if}}
          placeholder="some-blogpost-title" required>
      </div>
    </div>
    <div class="form-group row">
      <label for="post_content" class="col-sm-12 col-form-label">Content</label>
      <div class="col-sm-12">
        <textarea class="form-control" id="post_content" rows="3" name="content" required>{{#if content}}{{content}}
          {{/if}}</textarea>
      </div>
    </div>
    <div class="form-group row d-flex justify-content-between">
      <a class="btn btn-primary mb-2" href="/admin" role="button">Discard</a>
      <button type="submit" class="btn btn-primary mb-2">Publish</button>
    </div>

    <div class="alert alert-danger mt-2 missing-fields-alert" role="alert">

    </div>

    {{#if postError}}
    <div class="alert alert-danger mt-2" role="alert">
      {{postError}}
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    {{/if}}

  </form>
</div>

<script>

  (function () {
    'use strict';
    window.addEventListener('load', function () {
      const form = document.querySelector('.new-post-form');

      document.querySelector('#post_slug').addEventListener('keypress', (event) => {
        const regex = new RegExp("^[a-z\-]+$");
        const key = String.fromCharCode(event.charCode);
        if (!regex.test(key)) {
          event.preventDefault();
        }
      })

      form.addEventListener('submit', function (event) {
        event.preventDefault();
        if (!document.querySelector('#post_title').value && !document.querySelector('#post_content').value && !document.querySelector('#post_slug')) {
          const errorTextDisplay = document.createTextNode('Title, Content and Slug are Mandatory!');
          document.querySelector('.missing-fields-alert').firstChild.textContent = '';
          document.querySelector('.missing-fields-alert').prepend(errorTextDisplay);
          document.querySelector('.missing-fields-alert').style.display = 'block';
          return;
        }

        if (!document.querySelector('#post_title').value && !document.querySelector('#post_slug').value) {
          const errorTextDisplay = document.createTextNode('Title and Slug are Mandatory!');
          document.querySelector('.missing-fields-alert').firstChild.textContent = '';
          document.querySelector('.missing-fields-alert').prepend(errorTextDisplay);
          document.querySelector('.missing-fields-alert').style.display = 'block';
          return;
        }

        if (!document.querySelector('#post_content').value && !document.querySelector('#post_slug').value) {
          const errorTextDisplay = document.createTextNode('Content and Slug are Mandatory!');
          document.querySelector('.missing-fields-alert').firstChild.textContent = '';
          document.querySelector('.missing-fields-alert').prepend(errorTextDisplay);
          document.querySelector('.missing-fields-alert').style.display = 'block';
          return;
        }

        if (!document.querySelector('#post_title').value && !document.querySelector('#post_content').value) {
          const errorTextDisplay = document.createTextNode('Title and Content are Mandatory!');
          document.querySelector('.missing-fields-alert').firstChild.textContent = '';
          document.querySelector('.missing-fields-alert').prepend(errorTextDisplay);
          document.querySelector('.missing-fields-alert').style.display = 'block';
          return;
        }

        if (!document.querySelector('#post_title').value) {
          const errorTextDisplay = document.createTextNode('Title is Mandatory!');
          document.querySelector('.missing-fields-alert').firstChild.textContent = '';
          document.querySelector('.missing-fields-alert').prepend(errorTextDisplay);
          document.querySelector('.missing-fields-alert').style.display = 'block';
          return;
        }

        if (!document.querySelector('#post_content').value) {
          const errorTextDisplay = document.createTextNode('Content is Mandatory!');
          document.querySelector('.missing-fields-alert').firstChild.textContent = '';
          document.querySelector('.missing-fields-alert').prepend(errorTextDisplay);
          document.querySelector('.missing-fields-alert').style.display = 'block';
          return;
        }

        if (!document.querySelector('#post_slug').value) {
          const errorTextDisplay = document.createTextNode('Slug is Mandatory!');
          document.querySelector('.missing-fields-alert').firstChild.textContent = '';
          document.querySelector('.missing-fields-alert').prepend(errorTextDisplay);
          document.querySelector('.missing-fields-alert').style.display = 'block';
          return;
        }

        if (document.querySelector('#post_title').value && document.querySelector('#post_content').value && document.querySelector('#post_slug')) {
          form.submit();
        }

        form.classList.add('was-validated');

      }, false);
    }, false);
  })();
</script>